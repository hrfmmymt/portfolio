---
import { SECTION_LIST } from '../../app/constants/section-title';

const SECTION_ID_LIST = [
  SECTION_LIST.PROFILE,
  SECTION_LIST.CAREER,
  SECTION_LIST.ETC,
];
---

<div class="absolute right-4 top-4" id="nav-wrapper" data-menu-open="false">
  <button
    aria-label="Open menu"
    class="block bg-transparent border-none box-content mx-[3px] pt-[18px] px-[15px] pb-[12px] absolute right-0 top-0 transition-opacity duration-[250ms] ease-out sm:hidden before:bg-[rgba(51,51,51,0.1)] before:rounded-full before:content-[''] before:h-full before:left-0 before:absolute before:top-0 before:scale-0 before:origin-center before:w-full active:before:animate-pop"
    type="button"
    id="nav-hamburger"
  >
    <div class="bg-[#333] rounded-[1px] border-y border-[#333] text-[1px] h-[3px] mx-auto mb-[3px] p-0 relative origin-[0_0] transition-all duration-200 ease-out w-5"></div>
    <div class="bg-[#333] rounded-[1px] border-y border-[#333] text-[1px] h-[3px] mx-auto mb-[3px] p-0 relative origin-[0_0] transition-all duration-200 ease-out w-5"></div>
    <div class="bg-[#333] rounded-[1px] border-y border-[#333] text-[1px] h-[3px] mx-auto mb-[3px] p-0 relative origin-[0_0] transition-all duration-200 ease-out w-5"></div>
  </button>
  <nav class="hidden absolute top-20 w-full sm:flex sm:relative sm:top-0" id="nav-list">
    <ul class="flex flex-col items-center list-none p-0 w-full sm:flex-row">
      {SECTION_ID_LIST.map((id, index) => (
        <li class="leading-[5] m-0 sm:leading-normal last:sm:mr-4">
          <a
            class={`text-[#0057a7] block p-0 ${index < SECTION_ID_LIST.length - 1 ? 'after:border-0 after:m-0' : ''} hover:underline sm:text-[#333] sm:py-4 sm:pr-0 sm:pl-4 ${index < SECTION_ID_LIST.length - 1 ? 'sm:after:border-r sm:after:border-[#333] sm:after:content-[\'\'] sm:after:ml-4 sm:after:w-0' : ''}`}
            href={`#${id}`}
            data-scroll-to={id}
          >
            {id === 'etc' ? SECTION_LIST.ETC_PERIOD : id}
          </a>
        </li>
      ))}
    </ul>
  </nav>
</div>

<style is:global>
  @media (max-width: 414px) {
    [data-menu-open="true"] {
      background: #f2f2f2 !important;
      height: 100% !important;
      left: 0 !important;
      overflow: auto !important;
      padding: 0 !important;
      position: fixed !important;
      text-align: center !important;
      top: 0 !important;
      transform: translateZ(0) !important;
      transition: opacity 250ms ease, transform 250ms ease !important;
      width: 100% !important;
      z-index: var(--z-index-10) !important;
    }

    [data-menu-open="true"] nav {
      display: block !important;
    }

    [data-menu-open="true"] button[id="nav-hamburger"]::after {
      color: #0057a7;
      content: 'close';
      left: -30%;
      position: absolute;
      top: 35%;
    }

    [data-menu-open="true"] button[id="nav-hamburger"] > div:nth-child(1) {
      background: #0057a7 !important;
      transform: translate(4px, -1px) rotate(45deg) !important;
    }

    [data-menu-open="true"] button[id="nav-hamburger"] > div:nth-child(2) {
      background: #0057a7 !important;
      opacity: 0 !important;
    }

    [data-menu-open="true"] button[id="nav-hamburger"] > div:nth-child(3) {
      background: #0057a7 !important;
      transform: translate(2px, 1px) rotate(-45deg) !important;
    }
  }
</style>

<script>
  const wrapper = document.getElementById('nav-wrapper');
  const hamburger = document.getElementById('nav-hamburger');
  const navList = document.getElementById('nav-list');
  const links = document.querySelectorAll('[data-scroll-to]');

  if (hamburger && wrapper && navList) {
    hamburger.addEventListener('click', () => {
      const isOpen = wrapper.getAttribute('data-menu-open') === 'true';
      const newState = !isOpen;

      wrapper.setAttribute('data-menu-open', String(newState));
      hamburger.setAttribute('aria-label', newState ? 'Close menu' : 'Open menu');
    });

    // Smooth scroll
    links.forEach((link) => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = (e.currentTarget as HTMLElement).getAttribute('data-scroll-to');
        if (target) {
          const element = document.getElementById(target);
          if (element) {
            // Close menu on mobile first
            const isOpen = wrapper.getAttribute('data-menu-open') === 'true';
            if (isOpen) {
              wrapper.setAttribute('data-menu-open', 'false');
              hamburger.setAttribute('aria-label', 'Open menu');
            }

            // Calculate position with offset for fixed header
            const elementPosition = element.getBoundingClientRect().top;
            const offsetPosition = elementPosition + window.scrollY - 60;

            // Use requestAnimationFrame for smooth scroll
            const startPosition = window.scrollY;
            const distance = offsetPosition - startPosition;
            const duration = 200;
            let start: number | null = null;

            const animation = (currentTime: number) => {
              if (start === null) start = currentTime;
              const timeElapsed = currentTime - start;
              const progress = Math.min(timeElapsed / duration, 1);

              // Easing function
              const ease = progress < 0.5
                ? 2 * progress * progress
                : 1 - Math.pow(-2 * progress + 2, 2) / 2;

              window.scrollTo(0, startPosition + distance * ease);

              if (timeElapsed < duration) {
                requestAnimationFrame(animation);
              } else {
                // Set focus after scroll
                element.setAttribute('tabindex', '-1');
                element.focus();
              }
            };

            requestAnimationFrame(animation);
          }
        }
      });
    });
  }
</script>
