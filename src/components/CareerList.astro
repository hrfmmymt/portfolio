---
import Link from '../shims/next/link';
import { getCareerPosts } from '../../app/career/utils';

const posts = getCareerPosts();
const sortedPosts = posts.sort((a, b) => {
  if (new Date(a.metadata.startDate) > new Date(b.metadata.startDate)) {
    return -1;
  }
  return 1;
});
---

<ul class="mt-20 mx-auto max-w-[69rem] px-4 relative w-[90%] before:bg-[#005999] before:bottom-0 before:content-[''] before:left-[20%] before:ml-[3px] before:absolute before:top-0 before:w-1 max-tablet:mt-8 max-tablet:p-0 max-tablet:w-full max-tablet:before:hidden">
  {sortedPosts.map((post) => {
    const isMultiDevice = Array.isArray(post.metadata.device) && post.metadata.device.length > 1;
    const deviceLabel = isMultiDevice ? 'PC\nSP' : post.metadata.device;

    return (
      <li class="relative">
        <Link className="text-black transition-all duration-300 hover:transition-all hover:duration-100" href={`/career/${post.slug}`}>
          <div class="pr-[100px] absolute w-1/4 max-tablet:pb-5 max-tablet:relative max-tablet:w-full">
            <time datetime={post.metadata.startDate}>{post.metadata.startDate}</time>
            <span class="mx-[0.2rem]">-</span>
            <time datetime={post.metadata.endDate}>{post.metadata.endDate}</time>
          </div>
          <div class={`flex items-center justify-center bg-[#005999] rounded-full text-white h-14 w-14 left-[20%] -ml-8 absolute -top-2 z-[2] ${isMultiDevice ? 'leading-[1] whitespace-pre' : ''} max-tablet:float-right max-tablet:left-auto max-tablet:-mt-[55px] max-tablet:mr-[5px] max-tablet:mb-0 max-tablet:relative`}>
            <span class="text-center">{deviceLabel}</span>
          </div>
          <div class="career-card bg-white border border-[#888] rounded-[5px] text-[1.2rem] leading-[1.4] my-0 mb-16 ml-[25%] p-8 relative scale-100 transition-all duration-300 ease-in-out before:border-[solid_transparent] before:content-[' '] before:h-0 before:absolute before:right-full before:w-0 before:border-[rgba(136,136,136,0)] before:border-r-[#888] before:border-[11px] before:top-[9px] after:border-[solid_transparent] after:content-[' '] after:h-0 after:absolute after:right-full after:w-0 after:border-[rgba(255,255,255,0)] after:border-r-white after:border-[10px] after:top-[10px] max-tablet:m-0 max-tablet:mb-12 max-tablet:p-4 max-tablet:scale-100 max-tablet:transition-none max-tablet:before:border-[solid_transparent] max-tablet:before:bottom-full max-tablet:before:content-[' '] max-tablet:before:h-0 max-tablet:before:left-[10%] max-tablet:before:pointer-events-none max-tablet:before:absolute max-tablet:before:right-auto max-tablet:before:top-auto max-tablet:before:w-0 max-tablet:before:border-[rgba(136,136,136,0)] max-tablet:before:border-b-[#888] max-tablet:before:border-[11px] max-tablet:before:-ml-[11px] max-tablet:after:border-[solid_transparent] max-tablet:after:bottom-full max-tablet:after:content-[' '] max-tablet:after:h-0 max-tablet:after:left-[10%] max-tablet:after:pointer-events-none max-tablet:after:absolute max-tablet:after:right-auto max-tablet:after:top-auto max-tablet:after:w-0 max-tablet:after:border-[rgba(255,255,255,0)] max-tablet:after:border-b-white max-tablet:after:border-[10px] max-tablet:after:-ml-[10px] last:max-tablet:mb-4">
            <h3 class="career-title mt-0 border-b border-[rgba(0,0,0,0.4)] mx-auto mb-4 pb-[10px] max-tablet:mb-2">{post.metadata.title}</h3>
            <p class="block mb-6">{post.metadata.role}</p>
            <ul class="flex flex-row flex-wrap">
              {post.metadata.tagList.map((tag) => (
                <li class="bg-[#f1f8ff] rounded-[5px] text-[#0366d6] text-sm mr-2 mb-2 py-2 px-4 max-tablet:text-base">{tag}</li>
              ))}
            </ul>
          </div>
        </Link>
      </li>
    );
  })}
</ul>

<style is:global>
  /* Override h3 margin-top for career list items */
  ul h3 {
    margin-top: 0;
  }

  /* Hover and focus animations for timeline circles */
  .relative a:hover > div[class*="rounded-full"],
  .relative a:focus > div[class*="rounded-full"] {
    animation: bounceIn 1s both;
  }

  /* Hover and focus animations for career cards */
  .relative a:hover .career-card,
  .relative a:focus .career-card {
    backface-visibility: hidden;
    box-shadow: 0 0 3px #005999;
    transform: scale(1.22);
    transition: 0.1s all;
  }

  .relative a:hover .career-card::before,
  .relative a:focus .career-card::before,
  .relative a:hover .career-card::after,
  .relative a:focus .career-card::after {
    display: none;
  }

  /* Hover and focus animations for career titles */
  .relative a:hover .career-title,
  .relative a:focus .career-title {
    margin-left: 1rem;
  }

  @keyframes bounceIn {
    from,
    20%,
    40%,
    60%,
    80%,
    to {
      animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
    }

    0% {
      transform: scale3d(0.3, 0.3, 0.3);
    }

    20% {
      transform: scale3d(1.1, 1.1, 1.1);
    }

    40% {
      transform: scale3d(0.9, 0.9, 0.9);
    }

    60% {
      transform: scale3d(1.03, 1.03, 1.03);
    }

    80% {
      transform: scale3d(0.97, 0.97, 0.97);
    }

    to {
      transform: scale3d(1, 1, 1);
    }
  }

  @media (max-width: 768px) {
    .relative a:hover > div[class*="rounded-full"],
    .relative a:focus > div[class*="rounded-full"] {
      animation: none;
    }

    .relative a:hover .career-card,
    .relative a:focus .career-card {
      transform: scale(1);
      box-shadow: none;
      transition: none;
    }
  }
</style>
