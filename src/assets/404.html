<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>404 | # hirofumi miyamoto</title>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      width: 100%;
    }

    div {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    canvas {
      display: block;
      margin: 0;
      padding: 0;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <canvas id="canvas"></canvas>
  </div>
  <script>
    (() => {
      const status = '404'
      const text = status.split('')
      const chars = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']
      const scale = 100
      const breaks = 0.003
      const endSpeed = 0.05
      const firstLetter = 220
      const delay = 60
      const wrapper = document.getElementById('wrapper')
      const canvas = document.getElementById('canvas')
      const ctx = canvas.getContext('2d')

      const charMap = chars.map((el, i) => i)

      const offsets = text.map((el, i) => {
        const f = firstLetter + delay * i
        return {
          v: endSpeed + breaks * f,
          n: (-(1 + f) * (breaks * f + 2 * endSpeed)) / 2
        }
      })

      canvas.width = wrapper.clientWidth
      canvas.height = wrapper.clientHeight

      window.onresize = () => {
        let scale = 0
        ctx.clearRect(0, 0, canvas.width, canvas.height)
        canvas.width = wrapper.clientWidth
        canvas.height = wrapper.clientHeight
        scale = canvas.width
        ctx.setTransform(scale, 0, 0, scale, 0, 0)
      }

      requestAnimationFrame(
        (loop = () => {
          ctx.setTransform(1, 0, 0, 1, 0, 0)
          ctx.clearRect(0, 0, canvas.width, canvas.height)
          ctx.setTransform(scale, 0, 0, scale, 0, 0)
          ctx.globalAlpha = 1
          ctx.fillStyle = '#fff'
          ctx.fillRect(0, (canvas.height - scale) / 2, canvas.width, scale)
          for (let i = 0; i < text.length; i++) {
            ctx.fillStyle = '#000'
            ctx.textBaseline = 'middle'
            ctx.textAlign = 'center'
            ctx.setTransform(
              1,
              0,
              0,
              1,
              Math.floor((canvas.width - scale * (text.length - 1)) / 2),
              Math.floor(canvas.height / 2)
            )

            let o = offsets[i].n
            while (o < 0) o++
            o %= 1

            const h = Math.ceil(canvas.height / 7 / scale)
            for (let j = -h; j < h; j++) {
              let c = charMap[text[i]] + j - Math.floor(offsets[i].n)
              while (c < 0) c += chars.length
              c %= chars.length
              const s = 1 - Math.abs(j + o) / (canvas.height / 7 / scale + 1)
              ctx.globalAlpha = s
              ctx.font = `700 ${scale * s / 10}rem 'futura', sans-serif`
              ctx.fillText(chars[c], scale * (i * 1.12), (j + o) * scale * 2)
            }

            offsets[i].n += offsets[i].v
            offsets[i].v -= breaks
            if (offsets[i].v < endSpeed) {
              offsets[i].n = 0
              offsets[i].v = 0
            }
          }

          requestAnimationFrame(loop)
        })
      )
    })()
  </script>
</body>
</html>