---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCareerList } from '../../../app/career/utils';
import Markdown from '../../components/Markdown.astro';
import matter from 'gray-matter';
import { readFileSync } from 'node:fs';
import { join } from 'node:path';

export async function getStaticPaths() {
  const posts = await getCareerList();

  return posts.map((post) => {
    // Read markdown file at build time
    const filePath = join(process.cwd(), 'public', 'career', 'posts', `${post.slug}.md`);
    const fileContent = readFileSync(filePath, 'utf-8');
    const { content } = matter(fileContent);

    return {
      params: { slug: post.slug },
      props: {
        post: {
          ...post,
          content
        }
      },
    };
  });
}

const { post } = Astro.props;

if (!post || !post.content) {
  return Astro.redirect('/404');
}

const baseUrl = 'https://hrfmmymt.com';
const { title, role } = post.metadata;
const description = `${role} - ${post.metadata.tagList.join(', ')}`;
const ogImage = `${baseUrl}/og/${post.slug}.png`;

const tagList = post.metadata.tagList;
---

<BaseLayout title={title} description={description} ogImage={ogImage}>

  <main class="bg-white left-0 relative top-0 w-full" style="font-family: 'Noto Sans', sans-serif;">
    <header class="bg-white border-b border-[#999] left-0 py-4 px-4 fixed top-0 w-full z-[2] flex items-center md:pl-32 md:pr-0">
      <a href="/" class="bg-none border-0 text-[#005999] cursor-pointer inline-flex items-center font-[inherit] leading-normal mr-6 overflow-visible p-0 underline select-none hover:no-underline [&_svg]:fill-current [&_svg]:h-7">
        <svg aria-labelledby="backButtonTitle" viewBox="0 0 24 24">
          <title id="backButtonTitle">戻る</title>
          <g>
            <path d="M20 11H7.414l4.293-4.293a1 1 0 0 0-1.414-1.414l-6 6a1 1 0 0 0 0 1.414l6 6a.996.996 0 0 0 1.414 0 1 1 0 0 0 0-1.414L7.414 13H20a1 1 0 1 0 0-2z" />
          </g>
        </svg>
      </a>
      <h1 class="text-[1.2rem] font-bold tracking-[1.1px] leading-[1] m-0 md:text-2xl" itemprop="name">
        career
      </h1>
    </header>
    <div class="h-auto mt-20 p-0 px-4 pb-8 relative top-0 w-full md:h-auto md:mt-0 md:px-8 md:pb-8 md:absolute md:top-16">
      <div class="mx-0 md:mx-24">
        <h2 class="tracking-[1.2px]">{post.metadata.title}</h2>
        <h3>{post.metadata.role}</h3>
        <div class="mb-4">
          <time datetime={post.metadata.startDate}>{post.metadata.startDate}</time>
          <span class="mx-[0.2em]">-</span>
          <time datetime={post.metadata.endDate}>{post.metadata.endDate}</time>
        </div>
        <ul class="flex flex-row flex-wrap">
          {tagList.map((item) => (
            <li class="bg-[#f1f8ff] rounded-[5px] text-[#0366d6] text-sm mr-2 mb-2 py-2 px-4">
              {item}
            </li>
          ))}
        </ul>
        <article>
          <Markdown content={post.content} />
        </article>
      </div>
    </div>
  </main>
</BaseLayout>
